# CLAUDE.md

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã§ã‚³ãƒ¼ãƒ‰ã‚’æ‰±ã†éš›ã®Claude Code (claude.ai/code) ã¸ã®æŒ‡é‡ã‚’æä¾›ã—ã¾ã™ã€‚
Claude Codeã¯ä»¥é™æ—¥æœ¬èªã§å‡ºåŠ›ã‚’ã—ã¦ãã ã•ã„ã€‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

toyosatomimiï¼ˆéŸ³å£°åˆ†é›¢ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã¯ã€è¤‡æ•°ã®è©±è€…ã¨BGMãŒå«ã¾ã‚Œã‚‹éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€å„è©±è€…ã®éŸ³å£°ã‚’å€‹åˆ¥ã«æŠ½å‡ºã™ã‚‹Pythonã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

**ä¸»è¦æ©Ÿèƒ½:**
1. **BGMåˆ†é›¢**: Demucsï¼ˆhtdemucsï¼‰ã‚’ä½¿ç”¨ã—ã¦ãƒœãƒ¼ã‚«ãƒ«ã¨BGMã‚’åˆ†é›¢
2. **è©±è€…åˆ†é›¢**: pyannote-audio v3.1ã‚’ä½¿ç”¨ã—ã¦å„è©±è€…ã‚’è­˜åˆ¥ãƒ»åˆ†é›¢
3. **GPUåŠ é€Ÿ**: CUDAå¯¾å¿œã«ã‚ˆã‚‹é«˜é€Ÿå‡¦ç†
4. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½**: pyannote-audioãŒåˆ©ç”¨ã§ããªã„å ´åˆã®ç°¡æ˜“åˆ†é›¢

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
toyosatomimi/
â”œâ”€â”€ src/audio_separator/           # ã‚³ã‚¢å‡¦ç†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                   # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ processors/               # éŸ³å£°å‡¦ç†ãƒ—ãƒ­ã‚»ãƒƒã‚µ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ demucs_processor.py   # BGMåˆ†é›¢ï¼ˆDemucsï¼‰
â”‚   â”‚   â””â”€â”€ speaker_processor.py  # è©±è€…åˆ†é›¢ï¼ˆpyannote-audioï¼‰
â”‚   â””â”€â”€ utils/                    # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ audio_utils.py        # éŸ³å£°å‡¦ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ config_manager.py     # è¨­å®šç®¡ç†
â”‚       â””â”€â”€ file_utils.py         # ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
â”œâ”€â”€ tests/                        # ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ README.md                 # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¬ã‚¤ãƒ‰
â”‚   â”œâ”€â”€ outputs/                  # ãƒ†ã‚¹ãƒˆå‡ºåŠ›å…ˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
â”‚   â”‚   â””â”€â”€ latest/              # æœ€æ–°ã®å®Ÿè¡Œçµæœ
â”‚   â”œâ”€â”€ test_real_audio.py        # å®ŸéŸ³å£°çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ test_integrated_separation.py # BGM+è©±è€…åˆ†é›¢çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ test_speaker_simple.py    # pyannote-audioç’°å¢ƒãƒã‚§ãƒƒã‚¯
â”‚   â””â”€â”€ test_speaker_tuning.py    # è©±è€…åˆ†é›¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´
â”œâ”€â”€ data/input/                   # å…¥åŠ›éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ config/                       # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ pyproject.toml               # Pythonä¾å­˜é–¢ä¿‚å®šç¾©
â””â”€â”€ DEVELOPMENT_PLAN.md          # é–‹ç™ºè¨ˆç”»æ›¸ï¼ˆ5ãƒ•ã‚§ãƒ¼ã‚ºï¼‰
```

## é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å¿…è¦ãªç’°å¢ƒ
- **Python**: 3.10+
- **GPU**: NVIDIA GPUï¼ˆCUDA 12.1å¯¾å¿œï¼‰æ¨å¥¨
- **ãƒ¡ãƒ¢ãƒª**: 8GBä»¥ä¸Šã®RAMï¼ˆGPU: 6GB VRAMæ¨å¥¨ï¼‰
- **OS**: Linux/Windowsï¼ˆWSL2æ¨å¥¨ï¼‰

### ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ä»®æƒ³ç’°å¢ƒã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ
source .venv/bin/activate

# ä¸»è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install pyannote.audio  # è©±è€…åˆ†é›¢
pip install demucs          # BGMåˆ†é›¢

# ãã®ä»–ã®ä¾å­˜é–¢ä¿‚
pip install torch torchaudio --index-url https://download.pytorch.org/whl/cu121  # CUDAå¯¾å¿œPyTorch
pip install librosa soundfile scipy  # éŸ³å£°å‡¦ç†
```

### Hugging Faceèªè¨¼è¨­å®šï¼ˆpyannote-audioç”¨ï¼‰

```bash
# ç’°å¢ƒå¤‰æ•°è¨­å®š
export HF_TOKEN='your_huggingface_token_here'

# ãƒ¢ãƒ‡ãƒ«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åŒæ„ãŒå¿…è¦:
# https://huggingface.co/pyannote/speaker-diarization-3.1
```

## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### åŸºæœ¬ãƒ†ã‚¹ãƒˆ

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§å®Ÿè¡Œ
cd /path/to/toyosatomimi

# ç’°å¢ƒãƒã‚§ãƒƒã‚¯ï¼ˆpyannote-audioåˆ©ç”¨å¯èƒ½æ€§ï¼‰
source .venv/bin/activate
export HF_TOKEN='your_token'
python tests/test_speaker_simple.py

# å®ŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ï¼‰
python tests/test_real_audio.py data/input/input_wav.wav

# å‡ºåŠ›å…ˆæŒ‡å®š
python tests/test_real_audio.py data/input/input_wav.wav tests/outputs/my_test
```

### å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

å…¨ã¦ã®ãƒ†ã‚¹ãƒˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `tests/outputs/latest/` ã«å‡ºåŠ›ã•ã‚Œã¾ã™ï¼š

```
tests/outputs/latest/
â”œâ”€â”€ bgm_separated/           # BGMåˆ†é›¢çµæœ
â”‚   â”œâ”€â”€ vocals.wav          # ãƒœãƒ¼ã‚«ãƒ«éŸ³å£°ï¼ˆBGMé™¤å»æ¸ˆã¿ï¼‰
â”‚   â””â”€â”€ bgm.wav            # BGMéŸ³å£°
â””â”€â”€ speakers/              # è©±è€…åˆ¥éŸ³å£°
    â”œâ”€â”€ speaker_SPEAKER_00/ # è©±è€…1
    â”‚   â”œâ”€â”€ segment_001.wav # å€‹åˆ¥ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ
    â”‚   â”œâ”€â”€ segment_002.wav
    â”‚   â””â”€â”€ speaker_SPEAKER_00_combined.wav  # çµ±åˆéŸ³å£°
    â”œâ”€â”€ speaker_SPEAKER_01/ # è©±è€…2
    â””â”€â”€ speaker_SPEAKER_02/ # è©±è€…3
```

## å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
å…¥åŠ›éŸ³å£°ï¼ˆæ··åˆï¼‰ 
    â†“
1. BGMåˆ†é›¢ï¼ˆDemucs htdemucsï¼‰
    â”œâ”€â”€ vocals.wavï¼ˆãƒœãƒ¼ã‚«ãƒ«ï¼‰
    â””â”€â”€ bgm.wavï¼ˆBGMï¼‰
    â†“
2. è©±è€…åˆ†é›¢ï¼ˆpyannote-audioï¼‰
    â”œâ”€â”€ ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ¤œå‡º
    â””â”€â”€ è©±è€…è­˜åˆ¥
    â†“
3. éŸ³å£°æŠ½å‡º
    â”œâ”€â”€ speaker_SPEAKER_00/
    â”œâ”€â”€ speaker_SPEAKER_01/
    â””â”€â”€ speaker_SPEAKER_XX/
```

## æŠ€è¡“çš„è©³ç´°

### BGMåˆ†é›¢ï¼ˆDemucsProcessorï¼‰
- **ãƒ¢ãƒ‡ãƒ«**: `htdemucs`ï¼ˆé«˜å“è³ªéŸ³æºåˆ†é›¢ï¼‰
- **GPUåŠ é€Ÿ**: CUDAå¯¾å¿œã§å¤§å¹…ãªé«˜é€ŸåŒ–
- **å‡¦ç†æ™‚é–“**: 283ç§’éŸ³å£°ã‚’ç´„37ç§’ã§å‡¦ç†ï¼ˆRTX 2060ï¼‰
- **å‡ºåŠ›**: 44.1kHz WAVãƒ•ã‚¡ã‚¤ãƒ«

### è©±è€…åˆ†é›¢ï¼ˆSpeakerProcessorï¼‰
- **ãƒ¢ãƒ‡ãƒ«**: `pyannote/speaker-diarization-3.1`
- **æœ€å°ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé•·**: 1.0ç§’ï¼ˆèª¿æ•´å¯èƒ½ï¼‰
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: pyannote-audioåˆ©ç”¨ä¸å¯æ™‚ã¯ç°¡æ˜“åˆ†é›¢
- **å‡ºåŠ›**: è©±è€…åˆ¥ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ + çµ±åˆéŸ³å£°

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- **GPUå‡¦ç†**: CUDAåˆ©ç”¨ã§6-10å€é«˜é€ŸåŒ–
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: 283ç§’éŸ³å£°ã§ç´„89MBå‡ºåŠ›
- **åŒæ™‚è©±è€…æ•°**: å®Ÿç”¨çš„ä¸Šé™ã¯10äººç¨‹åº¦

## æ—¢çŸ¥ã®å•é¡Œã¨è§£æ±ºç­–

### 1. pyannote-audio ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼
```bash
# ç—‡çŠ¶: ModuleNotFoundError: No module named 'pyannote'
# è§£æ±º: ä»®æƒ³ç’°å¢ƒå†…ã«å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip uninstall -y pyannote.audio
pip install pyannote.audio
```

### 2. CUDA ãƒ¡ãƒ¢ãƒªã‚¨ãƒ©ãƒ¼
```bash
# GPU ãƒ¡ãƒ¢ãƒªä¸è¶³æ™‚ã¯CPUãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
# é•·æ™‚é–“éŸ³å£°ã¯åˆ†å‰²å‡¦ç†ã‚’æ¨å¥¨
```

### 3. NumPy äº’æ›æ€§
```bash
# NumPy 2.xç³»ã¨ã®éäº’æ›
pip install "numpy<2.0"
```

## é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ **ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆã‚³ã‚¢æ©Ÿèƒ½å®Ÿè£…ï¼‰** å®Œäº†æ¸ˆã¿ï¼š

- âœ… ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤
- âœ… ãƒ•ã‚§ãƒ¼ã‚º2: ã‚³ã‚¢æ©Ÿèƒ½å®Ÿè£…ï¼ˆBGMåˆ†é›¢ + è©±è€…åˆ†é›¢ï¼‰
- ğŸš§ ãƒ•ã‚§ãƒ¼ã‚º3: GUIå®Ÿè£…ï¼ˆæœªå®Ÿè£…ï¼‰
- ğŸš§ ãƒ•ã‚§ãƒ¼ã‚º4: æœ€é©åŒ–ãƒ»é«˜åº¦æ©Ÿèƒ½ï¼ˆæœªå®Ÿè£…ï¼‰
- ğŸš§ ãƒ•ã‚§ãƒ¼ã‚º5: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆï¼ˆæœªå®Ÿè£…ï¼‰

## é‡è¦ãªæ³¨æ„äº‹é …

### Hugging Faceåˆ©ç”¨è¦ç´„
- pyannote-audioãƒ¢ãƒ‡ãƒ«ã¯å­¦è¡“ãƒ»ç ”ç©¶ç”¨é€”ã«åˆ¶é™
- å•†ç”¨åˆ©ç”¨ã«ã¯åˆ¥é€”ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å¥‘ç´„ãŒå¿…è¦
- ãƒ¢ãƒ‡ãƒ«åˆ©ç”¨å‰ã«Hugging Faceä¸Šã§åˆ©ç”¨è¦ç´„ã¸ã®åŒæ„ãŒå¿…é ˆ

### GPUè¦ä»¶
- **æ¨å¥¨**: NVIDIA RTX 2060ä»¥ä¸Šï¼ˆ6GB VRAMï¼‰
- **æœ€å°**: GTX 1060ï¼ˆ3GB VRAMï¼‰
- CPU-onlyã§ã‚‚å‹•ä½œå¯èƒ½ï¼ˆå‡¦ç†æ™‚é–“ã¯6-10å€é•·ã„ï¼‰

### ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼
- **å…¥åŠ›å¯¾å¿œ**: WAV, MP3, FLAC, M4A, AAC
- **å‡ºåŠ›å½¢å¼**: WAVï¼ˆ44.1kHz, 16-bitï¼‰
- **æ¨å¥¨å…¥åŠ›**: WAVå½¢å¼ï¼ˆåœ§ç¸®ã«ã‚ˆã‚‹éŸ³è³ªåŠ£åŒ–ãªã—ï¼‰