# 開発計画書

## プロジェクト概要

**音声分離アプリケーション（toyosatomimi）**

複数の話者とBGMが混在する音声ファイルから、各話者の音声を個別に抽出するPythonアプリケーション。

## 開発目標

1. **高品質な音声分離**: DemucsとPyannote-audioを使用した2段階分離
2. **使いやすいGUI**: ドラッグアンドドロップ対応の直感的なインターフェース
3. **柔軟な設定**: パラメータ調整機能
4. **進捗の可視化**: リアルタイム処理状況表示

## 技術仕様

### 使用技術スタック
- **言語**: Python 3.8+
- **音声処理**: Demucs, pyannote-audio, librosa
- **GUI**: Tkinter
- **機械学習**: PyTorch
- **環境管理**: uv
- **テスト**: pytest

### 処理フロー
```
入力音声ファイル
    ↓
BGM分離（Demucs）
    ↓
ボーカル音声 + BGM
    ↓
話者分離（pyannote-audio）
    ↓
各話者の音声ファイル出力
```

## 開発フェーズ

### フェーズ1: 基盤構築
- [x] プロジェクト初期化
- [x] 依存関係の設定（pyproject.toml）
- [x] ディレクトリ構造の構築
- [x] 基本的な設定管理システム

### フェーズ2: コア機能実装
- [x] Demucs BGM分離処理（モック実装完了）
- [x] pyannote-audio 話者分離処理（モック実装完了）
- [x] 音声ファイル入出力ハンドリング
- [x] エラーハンドリング
- [x] 統合音声分離パイプライン ← **完了**

### フェーズ3: GUI実装
- [ ] メイン画面レイアウト
- [ ] ファイル選択・ドラッグアンドドロップ
- [ ] 設定パネル
- [ ] 進捗バー・ログ表示

### フェーズ4: 統合・テスト
- [ ] 全体統合
- [ ] ユニットテスト
- [ ] エラーケーステスト
- [ ] パフォーマンステスト

### フェーズ5: 最適化・文書化
- [ ] 性能最適化
- [ ] 使用方法ドキュメント
- [ ] インストールガイド
- [ ] トラブルシューティング

## ディレクトリ構造設計

```
toyosatomimi/
├── main.py                     # エントリーポイント
├── pyproject.toml              # プロジェクト設定
├── README.md                   # プロジェクト説明
├── CLAUDE.md                   # Claude Code用ガイド
├── DEVELOPMENT_PLAN.md         # 開発計画書
├── src/
│   └── audio_separator/
│       ├── __init__.py
│       ├── processors/         # 音声処理
│       │   ├── __init__.py
│       │   ├── demucs_processor.py
│       │   └── speaker_processor.py
│       ├── gui/                # GUI
│       │   ├── __init__.py
│       │   ├── main_window.py
│       │   └── components.py
│       └── utils/              # ユーティリティ
│           ├── __init__.py
│           ├── audio_utils.py
│           ├── file_utils.py
│           └── config_manager.py
├── config/
│   └── default_config.json     # デフォルト設定
├── tests/
│   ├── __init__.py
│   ├── test_processors.py
│   └── test_gui.py
└── scripts/
    └── install.py              # インストールスクリプト
```

## 実装優先度

### 高優先度
1. **Demucs BGM分離**: 音声とBGMの分離処理
2. **pyannote 話者分離**: 複数話者の識別・分離
3. **基本GUI**:ファイル選択とパラメータ設定
4. **設定管理**: 設定の保存・読み込み

### 中優先度
1. **進捗表示**: リアルタイム処理状況
2. **エラーハンドリング**: 適切なエラー処理とメッセージ
3. **ファイル形式対応**: 複数の音声形式サポート
4. **テスト**: 基本的なユニットテスト

### 低優先度
1. **最適化**: GPU利用最適化
2. **高度な設定**: 詳細パラメータ調整
3. **バッチ処理**: 複数ファイル一括処理
4. **プラグイン**: 拡張機能システム

## 技術的課題と対策

### 課題1: 大容量ファイル処理
- **対策**: チャンク処理、メモリ使用量監視

### 課題2: 処理時間の長さ
- **対策**: GPU活用、プログレスバー表示

### 課題3: 依存関係の複雑さ
- **対策**: uvによる環境管理、段階的インストール

### 課題4: 精度のばらつき
- **対策**: パラメータ調整機能、複数モデル対応

## 開発スケジュール

### 週1: 基盤構築
- プロジェクト構造作成
- 依存関係設定
- 基本的な設定管理

### 週2: コア機能実装
- Demucs統合
- pyannote-audio統合
- 基本的な音声処理

### 週3: GUI実装
- メイン画面作成
- ファイル操作機能
- 設定パネル

### 週4: 統合・テスト
- 全体統合
- テスト実装
- バグ修正

## 成功指標

1. **機能性**: 複数話者音声の正確な分離
2. **使いやすさ**: 直感的なGUI操作
3. **安定性**: エラーハンドリングの充実
4. **性能**: 適切な処理時間
5. **拡張性**: 新機能追加の容易さ

## 次のアクション

1. pyproject.tomlの作成
2. 基本ディレクトリ構造の構築
3. 依存関係のインストール
4. 最初のプロトタイプ実装

---

**作成日**: 2025年6月7日  
**更新日**: 2025年6月7日  
**ステータス**: 開発開始準備完了